/*
 * Copyright 2025 The Pigweed Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */

/* Linker script for LM3S6965 (ARMv7-M / Cortex-M3) minimal test */

ENTRY(Reset)

MEMORY
{
  /* LM3S6965 Memory Map:
   * Flash: 256KB at 0x00000000
   * SRAM:   64KB at 0x20000000
   */
  
  /* Vector Table (typically in flash) */
  VECTOR_TABLE(rx) : ORIGIN = {{arch.vector_table_start_address | hex}},
                     LENGTH = {{arch.vector_table_size_bytes}}
  
  /* Internal Flash */
  FLASH(rx) : ORIGIN = {{kernel.flash_start_address | hex}},
              LENGTH = {{kernel.flash_size_bytes}}
  
  /* Internal SRAM */
  RAM(rwx) : ORIGIN = {{kernel.ram_start_address | hex}},
             LENGTH = {{kernel.ram_size_bytes}}
}

SECTIONS
{
  .vector_table : ALIGN(512)
  {
    KEEP(*(.vector_table))
    . = ALIGN(4);
  } >VECTOR_TABLE

  .text :
  {
    . = ALIGN(4);
    *(.text .text.*)
    *(.rodata .rodata.*)
    . = ALIGN(4);
  } >FLASH

  .data :
  {
    . = ALIGN(4);
    *(.data .data.*)
    . = ALIGN(4);
  } >RAM AT>FLASH

  .bss :
  {
    . = ALIGN(4);
    *(.bss .bss.*)
    *(COMMON)
    . = ALIGN(4);
  } >RAM

  /* Stack grows downward from end of RAM */
  .stack (NOLOAD) :
  {
    . = ALIGN(8);
    _stack_start = .;
    . = . + {{kernel.stack_size_bytes}};
    _stack_end = .;
  } >RAM

  /DISCARD/ :
  {
    *(.ARM.exidx .ARM.exidx.*)
    *(.ARM.extab .ARM.extab.*)
  }
}
